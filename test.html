<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirect Gateway</title>
</head>
<body>
    <h2>Welcome to the Gateway</h2>
    <p>Redirecting you shortly...</p>

    <script>
        // Step 1: Generate unique session ID and provider ID (you can replace these with a real session generator)
        function generateUniqueID() {
            return Math.random().toString(36).substring(2, 15);
        }

        const sessionID = generateUniqueID();
        const providerID = generateUniqueID();

        // Step 2: Prepare the redirect URL with base64-encoded query parameters
        const redirectURL = "https://linkvertise.com/1283485/337.8461901063581/dynamic";
        const targetURL = "https://keyguardian.org/a/1210?id=" + sessionID + "&providerId=" + providerID;

        // Base64 encode the URL for redirection
        function base64Encode(str) {
            return btoa(str); // Using btoa() to base64 encode the URL
        }

        const encodedTargetURL = base64Encode(targetURL);

        // Step 3: Redirect to the monetization service (Linkvertise)
        window.location.href = `${redirectURL}?r=${encodedTargetURL}&o=sharing`;

        // Step 4: After the user returns, you'll need to check the token for verification
        function checkToken(token) {
            // This is where you would verify the token with your server
            fetch('/verify-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ token: token })
            })
            .then(response => response.json())
            .then(data => {
                if (data.isValid) {
                    alert("Token is valid! Access granted.");
                    // Redirect to the content page
                    window.location.href = 'https://yourcontentpage.com';
                } else {
                    alert("Invalid token. Please try again.");
                }
            })
            .catch(error => console.error('Error verifying token:', error));
        }

        // Simulate returning from the redirect page with a token
        // In real use, you'd get the token from the URL or another source
        const mockToken = "your_return_token_from_the_redirect";  // Replace this with the actual token from the URL
        checkToken(mockToken);
    </script>
</body>
</html>
